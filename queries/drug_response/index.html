<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.31.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>Drug Response &middot; BMEG</title>
  

  
  <link rel="stylesheet" href="https://bmeg.github.io/css/poole.css">
  <link rel="stylesheet" href="https://bmeg.github.io/css/darcula.css">
  <link rel="stylesheet" href="https://bmeg.github.io/css/syntax.css">
  <link rel="stylesheet" href="https://bmeg.github.io/css/theme.css">
  <link rel="stylesheet" href="https://bmeg.github.io/css/funnel.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://bmeg.github.io/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://bmeg.github.io/favicon.png">

  <script src="https://bmeg.github.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>

  <div class="global-header">
    <div class="global-header-container">
      <div class="global-header-home">
        <a href="http://bmeg.io"><h1>BMEG</h1></a>
      </div>
      <ul class="global-header-nav">
          <li><a href="https://bmeg.github.io/queries/">Make Queries</a></li>
          <li><a href="https://bmeg.github.io/building/">Build Graph</a></li>
          <li><a target="_blank" href="https://github.com/bmeg/">GitHub</a></li>
          <li><a target="_blank" href="https://gitter.im/bmeg/">Chat</a></li>
        </ul>
      <div class="global-header-ohsucb">
        <a href="https://www.ohsu.edu/compbio/"><h2>OHSU Comp Bio</h2></a>
      </div>
    </div>
  </div>


<div class="content section group">

  <div class="sidebar col span_3_of_12">
    <ul class="sidebar-nav">
      
      
        
        <li>
          
          <span class="intermediate"><a href="https://bmeg.github.io/queries/"
             class="sidebar-nav-item "
          >Queries</a></span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/install/"
                   class="sidebar-nav-item "
                >Install</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/getting_started/"
                   class="sidebar-nav-item "
                >Getting Started</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/traversal/"
                   class="sidebar-nav-item "
                >Traversal</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/matrix/"
                   class="sidebar-nav-item "
                >Matrix</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/drug_response/"
                   class="sidebar-nav-item  active"
                >Drug Response</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate"><a href="https://bmeg.github.io/building/"
             class="sidebar-nav-item "
          >Building Graph</a></span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/building/schema/"
                   class="sidebar-nav-item "
                >Schema</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/building/import/"
                   class="sidebar-nav-item "
                >Data Import</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/building/protograph/"
                   class="sidebar-nav-item "
                >Protograph</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <a href="https://bmeg.github.io/system/"
             class="sidebar-nav-item "
          >System</a></li>
          
        
        <li>
          
          <a href="https://bmeg.github.io/updates/"
             class="sidebar-nav-item "
          >Updates</a></li>
          
        
      
    </ul>
  </div>

  <div class="main col span_8_of_12">
    

<h1 id="get-all-ccle-samples">Get all CCLE samples</h1>

<pre><code>all_samples = O.query().has(&quot;gid&quot;, &quot;cohort:CCLE&quot;).outgoing(&quot;hasSample&quot;).values([&quot;gid&quot;]).execute()
</code></pre>

<h1 id="genes-we-ll-be-looking-at">Genes we&rsquo;ll be looking at</h1>

<pre><code>GENES = [&quot;CDKN2A&quot;, &quot;PTEN&quot;, &quot;TP53&quot;, &quot;SMAD4&quot;]
</code></pre>

<h1 id="scan-ccle-cell-lines-based-on-mutation-status">Scan CCLE cell lines based on mutation status</h1>

<pre><code>mut_samples = {}
norm_samples = {}
for g in GENES:
    #get CCLE samples with mutation
    mut_samples[g] = list(set(O.query().has(&quot;gid&quot;, &quot;gene:%s&quot; % (g)).incoming(&quot;variantInGene&quot;).outgoing(&quot;variantInBiosample&quot;).mark(&quot;a&quot;)\
    .incoming(&quot;hasSample&quot;).has(&quot;gid&quot;, &quot;cohort:CCLE&quot;).select(&quot;a&quot;).values([&quot;gid&quot;]).execute()))

    #get CCLE samples without mutation
    norm_samples[g] = list(set(all_samples).difference(mut_samples[g]))
    
    print &quot;%s Positive Set: %d&quot; % (g, len(mut_samples[g]))
    print &quot;%s Negative Set: %d&quot; % (g, len(norm_samples[g]))
</code></pre>

<h1 id="get-response-values-for-the-positive-set-samples-with-mutation-and-collect-auc-value-by-drug">Get response values for the positive set (samples with mutation) and collect AUC value by drug</h1>

<pre><code>pos_response = {}
for g in GENES:
    pos_response[g] = {}
    for row in O.query().has(&quot;gid&quot;, O.within(mut_samples[g])).outEdge(&quot;responseToCompound&quot;).mark(&quot;a&quot;).inVertex().mark(&quot;b&quot;).select([&quot;a&quot;, &quot;b&quot;]).execute():
        for v in json.loads(row['a']['properties']['responseSummary']):
            if v['type'] == &quot;AUC&quot;:
                compound = row['b']['gid']
                if compound not in pos_response[g]:
                    pos_response[g][compound] = [ v[&quot;value&quot;] ]
                else:
                    pos_response[g][compound].append(v[&quot;value&quot;])
</code></pre>

<h1 id="get-response-values-for-the-negative-set-samples-without-mutation-and-collect-auc-value-by-drug">Get response values for the negative set (samples without mutation) and collect AUC value by drug</h1>

<pre><code>neg_response = {}
for g in GENES:
    neg_response[g] = {}

    for row in O.query().has(&quot;gid&quot;, O.within(norm_samples[g])).outEdge(&quot;responseToCompound&quot;).mark(&quot;a&quot;).inVertex().mark(&quot;b&quot;).select([&quot;a&quot;, &quot;b&quot;]).execute():
        for v in json.loads(row['a']['properties']['responseSummary']):
            if v['type'] == &quot;AUC&quot;:
                compound = row['b']['gid']
                if compound not in neg_response[g]:
                    neg_response[g][compound] = [ v[&quot;value&quot;] ]
                else:
                    neg_response[g][compound].append(v[&quot;value&quot;])
</code></pre>

<h1 id="collect-t-test-statistics">Collect t-test statistics</h1>

<pre><code>drugs = set(itertools.chain.from_iterable( i.keys() for i in pos_response.values() ))
out = []
for drug in drugs:
    for g in GENES:
        row = {&quot;drug&quot; : drug, &quot;mutation&quot; : g}
        mut_values = pos_response[g][drug]
        norm_values = neg_response[g][drug]
        if len(mut_values) &gt; 5 and len(norm_values) &gt; 5:
            s = stats.ttest_ind(mut_values, norm_values, equal_var=False)
            row[&quot;t-statistic&quot;] = s.statistic
            row[&quot;t-pvalue&quot;] = s.pvalue
            s = stats.f_oneway(mut_values, norm_values)
            row[&quot;a-statistic&quot;] = s.statistic
            row[&quot;a-pvalue&quot;] = s.pvalue
            out.append(row)
</code></pre>

<h1 id="print-data-sorted-by-statistical-value">Print data sorted by statistical value</h1>

<pre><code>pandas.DataFrame(out, columns=[&quot;drug&quot;, &quot;mutation&quot;, &quot;t-statistic&quot;, &quot;t-pvalue&quot;, &quot;a-statistic&quot;, &quot;a-pvalue&quot;]).sort_values(&quot;a-pvalue&quot;)
</code></pre>

  </div>

</div>
</body>
</html>
