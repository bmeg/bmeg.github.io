<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.42.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>Drug Response &middot; BMEG</title>
  

  
  <link rel="stylesheet" href="https://bmeg.github.io/css/poole.css">
  <link rel="stylesheet" href="https://bmeg.github.io/css/darcula.css">
  <link rel="stylesheet" href="https://bmeg.github.io/css/syntax.css">
  <link rel="stylesheet" href="https://bmeg.github.io/css/theme.css">
  <link rel="stylesheet" href="https://bmeg.github.io/css/funnel.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://bmeg.github.io/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://bmeg.github.io/favicon.png">

  <script src="https://bmeg.github.io/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>

  <div class="global-header">
    <div class="global-header-container">
      <div class="global-header-home">
        <a href="http://bmeg.io"><h1>BMEG</h1></a>
      </div>
      <ul class="global-header-nav">
          <li><a href="https://bmeg.github.io/queries/">Make Queries</a></li>
          <li><a href="https://bmeg.github.io/building/">Build Graph</a></li>
          <li><a target="_blank" href="https://github.com/bmeg/">GitHub</a></li>
          <li><a target="_blank" href="https://gitter.im/bmeg/">Chat</a></li>
        </ul>
      <div class="global-header-ohsucb">
        <a href="https://www.ohsu.edu/compbio/"><h2>OHSU Comp Bio</h2></a>
      </div>
    </div>
  </div>


<div class="content section group">

  <div class="sidebar col span_3_of_12">
    <ul class="sidebar-nav">
      
      
        
        <li>
          
          <span class="intermediate"><a href="https://bmeg.github.io/queries/"
             class="sidebar-nav-item "
          >Queries</a></span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/install/"
                   class="sidebar-nav-item "
                >Install</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/getting_started/"
                   class="sidebar-nav-item "
                >Getting Started</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/traversal/"
                   class="sidebar-nav-item "
                >Traversal</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/kaplan_meier/"
                   class="sidebar-nav-item "
                >Kaplan Meier Curves</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/matrix/"
                   class="sidebar-nav-item "
                >Matrix</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/queries/drug_response/"
                   class="sidebar-nav-item  active"
                >Drug Response</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <span class="intermediate"><a href="https://bmeg.github.io/building/"
             class="sidebar-nav-item "
          >Building Graph</a></span></li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/building/schema/"
                   class="sidebar-nav-item "
                >Schema</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/building/import/"
                   class="sidebar-nav-item "
                >Data Import</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://bmeg.github.io/building/protograph/"
                   class="sidebar-nav-item "
                >Protograph</a></li>
            </ul>
          </li>
          
          
        
        <li>
          
          <a href="https://bmeg.github.io/system/"
             class="sidebar-nav-item "
          >System</a></li>
          
        
        <li>
          
          <a href="https://bmeg.github.io/updates/"
             class="sidebar-nav-item "
          >Updates</a></li>
          
        
      
    </ul>
  </div>

  <div class="main col span_8_of_12">
    

<h1 id="get-all-ccle-samples">Get all CCLE samples</h1>

<pre><code>q = O.query().V().where(aql.eq(&quot;_label&quot;, &quot;Biosample&quot;))
q = q.where(aql.and_(aql.eq(&quot;source&quot;, &quot;ccle&quot;))).render({&quot;id&quot;:&quot;_gid&quot;})
all_samples = []
for row in q:
    all_samples.append(row.id)
</code></pre>

<h1 id="genes-we-ll-be-looking-at">Genes we&rsquo;ll be looking at</h1>

<pre><code>GENES = [&quot;CDKN2A&quot;, &quot;PTEN&quot;, &quot;TP53&quot;, &quot;SMAD4&quot;]
gene_ids = {}
for g in GENES:
    for i in O.query().V().where(aql.eq(&quot;_label&quot;, &quot;Gene&quot;)).where(aql.eq(&quot;symbol&quot;, g)):
        gene_ids[g] = i.gid
</code></pre>

<h1 id="scan-ccle-cell-lines-based-on-mutation-status">Scan CCLE cell lines based on mutation status</h1>

<pre><code>mut_samples = {}
norm_samples = {}
for g, i in gene_ids.items():
    #get CCLE samples with mutation
    mut_samples[g] = set(k['gid'] for k in O.query().V(i).in_(&quot;variantIn&quot;).out(&quot;variantCall&quot;).out(&quot;callSetOf&quot;).where(aql.in_(&quot;_gid&quot;, all_samples)).render({&quot;gid&quot;:&quot;_gid&quot;}))

    #get CCLE samples without mutation
    norm_samples[g] = list(set(all_samples).difference(mut_samples[g]))

    print &quot;%s Positive Set: %d&quot; % (g, len(mut_samples[g]))
    print &quot;%s Negative Set: %d&quot; % (g, len(norm_samples[g]))
</code></pre>

<h1 id="get-response-values-for-the-positive-set-samples-with-mutation-and-collect-auc-value-by-drug">Get response values for the positive set (samples with mutation) and collect AUC value by drug</h1>

<pre><code>pos_response = {}
for g in GENES:
    pos_response[g] = {}
    for row in O.query().V(mut_samples[g]).in_(&quot;responseFor&quot;).mark(&quot;a&quot;).out(&quot;responseTo&quot;).mark(&quot;b&quot;).select([&quot;a&quot;, &quot;b&quot;]):
        for v in row['a']['data']['summary']:
            if v['type'] == &quot;AUC&quot;:
                compound = row['b']['gid']
                if compound not in pos_response[g]:
                    pos_response[g][compound] = [ v[&quot;value&quot;] ]
                else:
                    pos_response[g][compound].append(v[&quot;value&quot;])
</code></pre>

<h1 id="get-response-values-for-the-negative-set-samples-without-mutation-and-collect-auc-value-by-drug">Get response values for the negative set (samples without mutation) and collect AUC value by drug</h1>

<pre><code>neg_response = {}
for g in GENES:
    neg_response[g] = {}
    for row in O.query().V(norm_samples[g]).in_(&quot;responseFor&quot;).mark(&quot;a&quot;).out(&quot;responseTo&quot;).mark(&quot;b&quot;).select([&quot;a&quot;, &quot;b&quot;]):
        for v in row['a']['data']['summary']:
            if v['type'] == &quot;AUC&quot;:
                compound = row['b']['gid']
                if compound not in neg_response[g]:
                    neg_response[g][compound] = [ v[&quot;value&quot;] ]
                else:
                    neg_response[g][compound].append(v[&quot;value&quot;])
</code></pre>

<h1 id="collect-t-test-statistics">Collect t-test statistics</h1>

<pre><code>drugs = set(itertools.chain.from_iterable( i.keys() for i in pos_response.values() ))
out = []
for drug in drugs:
    for g in GENES:
        if drug in pos_response[g] and drug in neg_response[g]:
            row = {&quot;drug&quot; : drug, &quot;mutation&quot; : g}
            mut_values = pos_response[g][drug]
            norm_values = neg_response[g][drug]
            if len(mut_values) &gt; 5 and len(norm_values) &gt; 5:
                s = stats.ttest_ind(mut_values, norm_values, equal_var=False)
                row[&quot;t-statistic&quot;] = s.statistic
                row[&quot;t-pvalue&quot;] = s.pvalue
                s = stats.f_oneway(mut_values, norm_values)
                row[&quot;a-statistic&quot;] = s.statistic
                row[&quot;a-pvalue&quot;] = s.pvalue
                out.append(row)
</code></pre>

<h1 id="print-data-sorted-by-statistical-value">Print data sorted by statistical value</h1>

<pre><code>pandas.DataFrame(out, columns=[&quot;drug&quot;, &quot;mutation&quot;, &quot;t-statistic&quot;, &quot;t-pvalue&quot;, &quot;a-statistic&quot;, &quot;a-pvalue&quot;]).sort_values(&quot;a-pvalue&quot;)
</code></pre>

<h1 id="traversal-direction-optimization">Traversal direction optimization</h1>

<p>Note, there is a slower version of this query:</p>

<pre><code>q = O.query().V(all_samples).in_(&quot;callSetOf&quot;).in_(&quot;variantCall&quot;).out(&quot;variantIn&quot;).where(aql.eq(&quot;gene:ENSG00000141510&quot;, &quot;_gid&quot;)).count()
#print list(q)
</code></pre>

  </div>

</div>
</body>
</html>
